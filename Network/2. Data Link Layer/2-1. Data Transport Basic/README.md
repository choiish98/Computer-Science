## (2) 데이터 링크 계층

### (1) 데이터 전송의 기초

#### (1) 데이터 전송 방식

컴퓨터 네트워크는 독립적으로 실행되는 호스트들을 연결해 하나의 통신망을 구성한 것이다. 네트워크를 통해 다음과 같은 효과를 볼 수 있다.

- **자원 공유**: 자원 공유는 컴퓨터 하드웨어뿐 아니라 `각 호스트에서 사용하는 논리적인 정보를 공유하는 것`이다. 자원을 더 효율적으로 활용할 수 잇게 해주어 네트워크를 발전시킨 1차 요인이기도 하다.
- **병렬 처리에 의한 성능 향상**: 병렬 처리는 원래 컴퓨터 시스템 내부에서 구현되고 발전되어 왔다. 네트워크가시스템 버스 역할을 수해항는 방식의 분산 병렬 처리 시스템에 대한 연구는 이전부터 많이 진행되었지만, 네트워크 속도의 제한 때문에 한계가 있었다. 그러나 네트워크 속도가 계속 향상됨에 따라 네트워크를 활용한 분산 병렬 처리의 효과도 크게 향상되고 있다. 이는 `시스템이 수행할 작업을 분할해 동시에 처리 함으로써 처리 시간을 단축 시키는 효과를 얻는다.`
- **중복 저장으로 신뢰성 향상**: 중복 저장은 네트워크에 연결된 시스템이 보관하는 정보의 신뢰성을 향상시키기 위해 사용한다. 중요한 정보를 여러 시스템에 중복 저장하고, 중복에 따른 부가 처리는 컴퓨터 시스템이 자동으로 해결해줌으로써 하드디스크 손상과 같은 `특정 시스템에서 발생한 데이터 손실을 복구할 수 있다.` 그러나 `신뢰성의 정도가 향상됨에 따라 시스템 성능은 저하될 수 있다.`

##### (1) 전송과 교환

송신 호스트가 수신 호스트에 데이터를 전달 하려면 전송과 교환 과정을 거쳐야 한다. **교환**은 전달 경로가 둘 이상일 때 라우터에서 `데이터를 어느 방향으로 전달할 지를 선택하는 기능`으로, 다양한 기준에 따라 데이터를 올바른 경로로 전달할 수 있도록 해준다. **전송**은 특정한 물리 매체에 의하여 일대일로 직접 연결된 `두 시스템 간의 신뢰성 있는 데이터 전송`을 보장하기 위한 것이다.

###### (1) 전송과 교환 개요

![4-1  전송과 교환](https://user-images.githubusercontent.com/56579239/158424963-29bc98b5-0255-483c-bd11-ebebdc8f7a06.png)

호스트 a에서 호스트 d로 데이터를 전달하려면 다음과 같은 세 과정을 순차적으로 진행해야 한다.

- 호스트 a와 호스트 c 간의 직접 연결에 의한 전송
- 호스트  c에서의 올바른 경로 선택을 의미하는 교환
- 호스트 c와 호스트 d 간의 직접 연결에 의한 전송

###### (2) 전송 방식의 분류

데이터 전송 및 교환 기술에 따라 네트워크를 분류하는 방식은 다음과 같다.

- **점대점 방식**: `각 호스트를 직접 연결해 목적지 호스트에 데이터를 전송`하는 방식으로, 호스트 간의 데이터 전달 과정에서 송신 호스트가 중개 호스트와 일대일로 연결되므로 다른 호스트에는 데이터가 전달되지 않는다. 따라서 데이터를 최종 목먹지 호스트까지 올바르게 전달하려고 인접 호스트에 전송하는 과정을 단계적으로 반복한다. 원거리에 있는 시스템 사이의 통신 방식으로, WAN 환경에서 주로 사용한다.
- **브로드캐스트 방식**: `공유 매체 하나에 여러 호스트를 연결하기 때문에 네트워크에 연결된 모든 호스트에 데이터가 전송된다.` 자신을 목적지로 하지 않는 데이터는 버려 결국 하나의 목적지 호스트만 수신 하도록 설계한다. LAN처럼 지리적으로 가까운 호스트 사이의 통신에서 주로 사용한다.

##### (2) 점대점 방식

점대점 방식은 전체 연결 개수가 많아지면 성능 면에서 유리하지만 전송 매체의 길이가 증가해 비용이 많이 든다. 반대로 연결 개수가 적어지면 전송 매체를 더 많이 공유해 네트워크 혼잡도가 증가한다. 따라서 네트워크 트래픽이 많이 발생하는 구간에서는 전송 매체의 수를 늘리고, 그렇지 않은 구간에서는 줄이는 것이 좋다.

###### (1) 스타형

**스타형**은 중앙에 있는 `하나의 중개 호스트 주위로 여러 호스트를 일대일로 연결하는 형태`이다. 주변 호스트가 데이터를 송수신하려면 반드시 중앙의 중개 호스트를 거쳐야 한다. 따라서 중앙 호스트의 신뢰성이 전체 네트워크의 성능과 신뢰성에 영향을 많이 준다. 또 데이터를 적절한 목적지로 전송하는 중개 기능도 중앙 호스트가 독점적으로 담당한다.

스타형은 중앙에 있는 스타 구조 `주변에 위치한 호스트들을 중심으로 새로운 스타 구조를 확장`하는 형태로 확장할 수 있다. 이를  **트리형**이라 하는데, 트리형의 장점은 모든 데이터가 중앙 호스트를 중심으로 라우팅 되므로 중개 과정이 간단하다는 점이다. 반대로 중앙 호스트에 문제가 발생하면 전체 네트워크의 동작에 영향을 많이 준다는 단점이 있다.

###### (2) 링형

**링형**은 호스트의 연결이 `순환 고리 구조`이며, `전송 데이터가 브로드캐스팅 되는 특징`이 있다. 그러나 `일대일로 직접 연결되기 때문에 점대점 방식`에도 포함된다. 송신 호스트와 수신 호스트의 거리가 멀수록 데이터 전달 과정에 개입하는 중개 호스트의 개수도 자연히 증가한다.

네트워크에 연결된 모든 호스트가 데이터 전송과 교환 기능을 동시에 수행할 수 있어야 한다. 링형에서는 데이터를 한 방향으로만 전달하도록 설계한다. 왜냐하면 데이터 전달 방향을 고정하면 복잡한 처리 과정이 단순해져 중개되는 호스트의 개수를 줄이는 것보다 유리하기 때문이다.

링형에서는 연결된 여러 호스트가 데이터를 동시에 전송하면 데이터 충돌이 발생할 수 있다. 따라서 호스트 사이의 데이터 송신 시점을 제어하는 기능이 필요한데, 토큰이라는 특수한 제어 프레임이 이 기능을 수행한다. 토큰은 전송 권한을 의미하기 때문에 호스트가 데이터를 전송하려면 토큰을 꼭 확보해야 한다. 평소에는 링 네트워크에 하나의 토큰이 순환하는데, 데이터를 전송하려는 호스트는 토큰이 도착하면 이를 내부에 보관한 후 데이터 전송을 시작한다. 그리고 데이터가 네트워크를 한 바퀴 순환하여 되돌아오면 데이터 전송이 완료된 것으로 토큰을 다시 링 네트워크에 돌려주어야 한다. 이러한 과정이 반복적으로 이루어지면서 링에 연결된 모든 호스트가 토큰을 확보하고, 데이터 전송 기회가 동등하게 부여된다.

링형의 단점은 한 호스트가 고장나면 전체 네트워크가 동작하지 않을 수 있다는 것이다. 따라서 장전이나 기타 원인에 의해 오동작하는 호스트는 네트워크에서 논리적으로 분리하여 고립시킬 수 있어야 한다.

###### (3) 완전형

**완전형**은 네트워크에 존재하는 `모든 호스트가 다른 모든 호스트와 일대일로 직접 연결하는 방식`이다. 호스트끼리 서로 공유하지 않는 전용 전송 매체로 직접 연결하기 때문에 교환 기능이 필요 없다.

완전형의 단점은 사용하는 전송 매체의 개수가 증가하면 비용 측면에서 극단적으로 비효율적이라는 것이다. 특별한 목적을 위해 제한적으로 연결하는 경우를 제외하면완전형을 사용하는 경우는 거의 없다고 볼 수 있다.

###### (4) 불규칙형

**불규칙형**은 전송 매체에 의한 `연결 구조를 특정 패턴으로 분류할 수 없다`는 뜻이다. 일반 네트워크의 연결 형태는 불규칙형이며, 네트워크에서 고려 해야 하는 여러 환경 요인에 의해 연결 구조가 결정된다.

##### (3) 브로드캐스트 방식

WAN 같은원거리 통신망에서는 특정 호스트 사이를 직접 연결할 전송 매체가 있는지, 아니면 어떤 우회 경로로 몇 단계를 거쳐서 연결할 수 있는지에 대한 판단이 중요하다. 그러나 LAN에서는 연결의 존재 여부보다는 데이터를 목적지 호스트까지 얼마나 효율적으로 잔달할 수 있는지가 중요한 잣대가 된다. 이를 지원하는 브로드캐스팅 방식은 네트워크의 모든 호스트를 하나의 전송 매체로 연결하므로, 중개 기능을 수행하는 교환 호스트가 필요 없다.

###### (1) 버스형

**버스형**은 공유 전송 매체인 `버스에 모든 호스트를 연결`하므로 공유 버스에 연결된 `모든 호스트가 전송 데이터를 수신`할 수 있다. 그러나 둘 이상의 호스트에서 데이터를 동시에 전송하면 데이터 충돌이 발생할 수 있으므로 충돌에 따른 오류 문제를 해결해야 한다.

**충돌 문제**는 크게 두 가지 방법으로 해결할 수 있다. 첫째, 호스트의 전송 권한을 제한함으로써 사전에 충돌을 예방할 수 있다. 이 방식에서 호스트가 `데이터를 전송하려면 사전에 전송 권한을 확보`해야 한다. 전송 권한을 확보하는 방법에는 전송 시간대를 분할하여 각 호스트별로 데이터를 전송할 수 있는 `시간대를 다르게 지정`하는 방법과 `토큰`으로 전송 권한을 순환적으로 이용하는 방법이 있다.

두 번째 방식은 `충돌 허용`이다. 둘 이상의 호스트가 데이터를 동시에 전송할 수 있도록 허용하지만, 충돌이 발생했을 때 이를 감지하고 해결하는 과정이 필요하다. 대표적인 공유 버스 방식인 이더넷에서 채택하는 방식이 충돌 허용의 예이다.

###### (2) 링형

**링형**은 특정 `송신 호스트가 전송한 데이터가 링을 한 바퀴 돈 후에, 다시 송신 호스트로 되돌아 오는 방식`이다. 링형은 점대점 방식과 브로드캐스팅 방식의 기준에 모두 부합하는 구조이다. 네트워크의 호스트가 일대일 연결 구조를 지원한다는 측면에서 `점대점 방식을 지원`하고, 전송 데이터가 모든 호스트에 전달된다는 측면에서 `브로드캐스팅 방식을 지원`한다.

##### (4) 멀티포인트 통신

컴퓨터의 통신의 가장 기본적인 형식은 `두 호스트 사이의 데이터 전송`을 의미하는 **유니캐스팅** 방식이다. 인터넷에서 제공되는 텔넷, FTP, 웹 검색과 같은 대부분의 서비스는 유니캐스팅 방식을 사용한다.

하나의 송신 호스트를 기준으로, `수신 호스트 하나와 연결`되면 **유니포인트**가 되고, `다수의 수신 호스트와 연결`되면 **멀티포인트**가 된다. 송신 호스트가 `한 번의 전송으로 수신 호스트 하나에만 데이터를 전송`할 수 있으면 **유니캐스팅**이고, `다수의 수신 호스트에 전송`할 수 있으면 **멀티캐스팅**이다.

###### (1) 멀티포인트 유니캐스팅

유니캐스팅 방식의 프로토콜은 두 호스트 사이의 일대일 통신만 지원한다. 따라서 유니캐스팅 방식을 이용해 일대다 통신을 하려면 **멀티포인트 유니캐스팅** 방식을 사용해야 한다.

유니캐스팅 방식은 송수힌 호스트 사이의 흐름 제어와 수신 호스트의 응답 기능 및 재전송 기능 등을 구현하기 좋다. 그러나 멀티포인트 유니캐스팅의 경우, 수신 호스트 수가 적을 때는 문제없지만, 그 수가 많아지면 성능 면에서 여러 문제가 나타날 수 있다.

###### (2) 브로드캐스팅

브로드캐스팅에서 수신된 데이터에 대한 처리는 수신 호스트의 몫으로, 목적지 주소를 근거로 데이터의 받아들임과 폐기를 결정한다.

브로드캐스팅 방식에서는 호스트 수가 많을수록 네트워크 트래픽이 급격히 증가하는 단점이 있다. 따라서 이 방식을 사용해야 한다면 네트워크 전체에 데이터를 전송하기보다 특정 서브넷 내에서 이용하는 것이 좋다.

###### (3) 멀티캐스팅

**멀티캐스팅** 방식은 프로토콜 자체에서 일대다 전송 기능을 구현하기 때문에 통신 환경을 연결 설정 요구 한 번으로 지원할 수 있다. 데이터 전송 과정에서도, 멀티포인트 유니캐스팅에서는 수신 호스트의 수만큼 데이터를 반복 전송해야 하지만, 멀티캐스팅에서는 송신 호스트의 전송 요구 한 번으로 모든 수신 호스트에 데이터를 전달할 수 있다.

멀티캐스팅의 응용 예는 매우 다양하다. 인터넷 멀티미디어 환경에서 제공하는 비디오 및 오디오 서비스, 화상 회의 서비스 등을 비롯해 자사에 등록된 다수 고객을 대상으로 하는 형태의 데이터 서비스가 멀티캐스팅 방식이다.

멀티캐스팅을 구현하려면 멀티캐스트 그룹을 생성하고 관리하는 기능이 필요하다. 예를 들어, 임의의 호스트가 특정 멀티캐스트 그룹에 가입하고 타뢰하는 기능이 이에 해당한다. 또 멀티캐스트 데이터를 중개하는 라우터에서 멀티캐스트 그룹 주소를 인식하고, 다수의 수신 호스트에 중개하는 등의 멀티캐스트 트래픽에 대한 처리 기능도 구현되어야 한다.

#### (2) 오류제어

데이터 링크 계층 프로토콜이 전송 오류 기능을 제공하려면 우선 오류 발생 여부를 인지할 수 잇어야 한다. 오류의 종류에는 데이터가 깨져서 도착하는 프레임 변형과 목적지에 도착하지 못하는 프레임 분실이 있다.

##### (1) 전송 오류의 유형

- **수신 호스트의 응답 프레임**: 송신 호스트가 전송한 데이터 프레임의 일부가 깨지는 `프레임 변형 오류를 확인`한 수신 호스트는 송신 호스트에 응답 프레임을 전송해 원래의 `데이터 프레임을 재전송하도록 요구`할 수 있다. 수신 호스트가 전송하는 응답 프레임의 종류에는 데이터 프레임이 정상적으로 도착했을 때 회신하는 긍정 응답 프레임과 데이터 프레임이 깨졌을 때 회신하는 부정 응답 프레임이 있다.

- **송신 호스트의 타이머 기능**: 송신 호스트가 전송한 프레임이 수신 호스트에 도착하지 못하는 `프레임 분실 오류가 발생`하면 수신 호스트는 이 사실을 인지할 수 없다. 따라서 오류 복구 과정이 송신 호스트 주도로 이루어져야 한다. 송신 호스트는 데이터 프레임을 전송한 후에 일정 시간 이내에 수신 호스트로부터 긍정/부정 응답 프레임 회신이 없으면 **타임아웃** 기능을 동작시켜 `데이터 프레임을 재전송`한다.

- **순서 번호 기능**: 수신 호스트가 보낸 긍정 응답 프레임을 분실하면 데이터 프레임이 제대로 도착해도 송신 호스트가 이를 인지할 수 없다. 따라서 송신 호스트가 타임아웃 기능에 의해 원래 프레임을 재전송함으로써 수신 호스트가 데이터 프레임을 중복 수신하는 결과를 초래한다. 이럴 때 수신 호스트가 중복 데이터 프레임을 가려내려면 각 프레임 내부에 **순서 번호**를 기입해야 한다.

  데이터 프레임은 원래의 데이터 외에 오류 검출을 위한 정보도 함께 제공한다. 오류 검출을 위한 정보에는 수신 호스트에서 오류를 감지하는 기능만 하는 정보와 오류가 발생한 프레임을 복구하는 기능을 하는 정보가 있다.

##### (2) 흐름 제어

오류 제어와 함께 데이터 링크 계층에서 제공하는 주요 기능은 데이터 프레임의 전송 속도를 조절하는 것이다. 송신 호스트는 수신 호스트가 감당할 수 있을 정도의 전송 속도를 유지하면서 데이터 프레임을 전송해야 하는데, 이러한 기능을 **흐름 제어**라 한다. 흐름 제어는 송신 호스트가 수신 호스트보다 아주 빨리 데이터를 전송하는 경우에 필요하다.

흐름 제어 기능을 제공하지 않으면 수신 호스트는 자신에게 도착한 데이터 프레임을 내부 버퍼에 보관할 여유를 갖지 못 한다. 따라서 전송 매체를 통해 올바르게 도착한 프레임이 분실되는 결과를 초래할 수 있다. 흐름 제어 기능의 부재에 따른 프레임 분실은 전송 오류의 프레임 분실과 같은 동일한 결과를 가져오기 때문에 이것도 데이터를 재전송 하는 방법으로 복구해야 한다.

흐름 제어의 기본 원리는 수신 호스트가 다음에 수신할 데이터 프레임의 전송 시점을 송신 호스트에 통지하는 방식이다. 가장 많이 사용하는 흐름 제어 프로토콜의 예는 슬라이딩 윈도우 프로토콜이다.

#### (3) 프레임

데이터 링크 계층에서 전송 데이터를 프레임이라는 작은 단위로 나누어 처리한다. 전송 프레임에는 상위 계층에서 보낸 전송 데이터의 오류를 확인하기 위한 체크섬, 송신 호스트의 주소, 기타 프로토콜에서 사용하는 제어 코드 같은 정보가 포함된다.

프레임을 전송받은 수신 호스트는 제일 먼저 체크섬을 확인해 전송 중에 프레임 변형 오류가 발생했는지 확인해야 한다. 오류가 발생하면 부정 응답 프레임을 회신하여 복구 과정을 시작해야 한다.

일반적으로 프레임은 내부에 정보를 표현하는 방식에 따라 문자 프레임과 비트 프레임으로 구분된다.

##### (1) 문자 프레임

**문자 프레임**은 `프레임 내용이 문자로 구성`되므로 문자 데이터를 전송할 때 사용한다. 문자 프레임 방식은 8비트 단위의 고정 크기로 동작한다.

###### (1) 프레임의 구조

하나의 프레임 단위를 구분하기 위해 프레임의 앞뒤에 ASCII 코드의 특수 문자를 이용한다. 즉, `각 프레임의 시작 위치와 끝 위치에 DLE + STX 또는 DLE + ETX 문자를 추가하여 프레임의 다른 정보와 구분`할 수 있도록 한다.

이 방식의 문제점은 데이터의 내용 중에 DLE+STX 또는 DLE+ELX 문자가 포함될 수 있다는 것이다. 결과적으로 프레임을 수신하는 호스트가 프레임의 시작과 끝 위치를 결정하는 데 혼선을 준다. 이러한 현상은 문자 프레임 방식을 사용해 실행 파일과 같은 이진 코드 데이터를 전송하는 경우에 발생할 확률이 높다.

###### (2) 문자 스터핑

**문자 스터핑**은 `문자 프레임 내부의 전송 데이터에 DLE 문자가 포함되면서 발생하는 혼란을 예방하는 방법`이다. 송신 호스트가 전송하는 데이터를 미리 조작함으로써 혼선의 여지를 없앨 수 있다. 즉, `전송 데이터가 DLE 문자를 포함하면 DLE 문자 다음에 DLE 문자 하나를 강제로 추가한다.`

수신 호스트는 프레임 내용에 DLE 문자가 연속해서 두 번 나타나면 두 번째 DLE는 송신 호스트가 임의로 추가한 문자라고 판단할 수 있다. 따라서 상위 계층인 네트워크 계층에 데이터를 전달하기 전에 둘 중 하나를 제거해야 한다. 이는 송신 호스트가 최초에 전송한 프레임과 동일한 결과가 된다. 이와 같이 `문자 프레임의 전송 과정에서 제어 문자를 추가하는 기능`을 문자 스터핑이라 한다. `문자 스터핑이 올바르게 동작하는 이유는 프레임의 시작과 끝을 나타내는 제어 코드에는 어떤 경우에도 DLE 문자가 연속해서 두 번 발생하지 않기 때문`이다.

##### (2) 비트 프레임

**비트 프레임** 방식은 문자 단위의 가정을 없애고, 임의의 `비트 패턴 데이터`를 전송할 수 있다. `프레임의 시작과 끝 위치에 플래그라는 특수하게 정의된 비트 패턴(01111110)을 사용해 프레임 단위를 구분`한다.

문자 프레임 방식에서 DLE 패턴이 프레임의 내용에 나타날 가능성이 있는 것처럼, 비트 프레임 방식에도 플래그와 동일한 비트 패턴을 포함할 수 있다. 따라서 데이터의 내용에 이 패턴이 나타나면 전송하기 전에 이를 적당히 조작하느 과정이 필요하다.

###### (1) 비트 스터핑

비트 프레임 방식에서는 송신 호스트가 전송하고자 하는 데이터의 내용 중에 `값이 1인 패턴이 연속해서 5번 발생하면 강제로 0을 추가해 전송`한다. 플래그는 1이 연속해서 6개 나오는 패턴이므로 원천적으로 데이터 내용에 플래그 패턴이 발생하는 것을 차단하기 위함이다. 이와 같은 기능을 **비트 스터핑**이라 하며, 수신 호스트는 송신 과정에서 축된 0을 제거하여 원래의 데이터를 상위 계층에 전달한다.

#### (4) 다항 코드

##### (1) 오류 검출

###### (1) 패리티 비트

###### (2) 블록 검사

##### (2) 다항 코드

###### (1) 생성 다항식

###### (2) 체크섬의 예
